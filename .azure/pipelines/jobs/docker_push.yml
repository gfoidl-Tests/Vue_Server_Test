jobs:
  - job: docker_push
    displayName: docker push to GH-packages
    pool:
      vmImage: ubuntu-18.04
    variables:
      image_name: gfoidl-tests/vue-server-tests
    steps:
      - checkout: none

      - task: DownloadPipelineArtifact@2
        inputs:
          buildType: 'specific'
          project: 'b917ef97-c76f-4ce5-a20e-a2eb342180cb'
          definition: '34'
          buildVersionToDownload: 'specific'
          pipelineId: '1423'
          artifactName: 'image'
          targetPath: '$(Build.SourcesDirectory)'

      - bash: |
          docker load -i image.tar.gz
          docker tag $IMAGE_NAME $IMAGE_NAME/web-app:$(Build.Id)

          echo "-------------------------------------------------"
          docker images
        displayName: import docker image

      - task: Docker@2
        inputs:
          containerRegistry: github-gfoidl-tests-docker
          repository: gfoidl-tests/vue_server_test/web-app
          command: push
